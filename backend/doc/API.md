# API

# リスト

- LINE
  - ブロードキャストメッセージ送信 API
  - 参加登録 API
  - 友だち登録/解除/更新 API
  - アクセストークン発行/取得 API
- 設定
  - チャネル ID・シークレット登録/取得 API
- イベント
  - イベント一覧取得 API
  - 個別イベント取得 API
  - イベント作成 API

# ブロードキャストメッセージ送信 API

**入力**

| 物理名           | 論理名                  | 備考 |
| ---------------- | ----------------------- | ---- |
| message          | LINE 送信テキスト       |      |
| leftButtonLabel  | LINE 左側ボタンラベル名 |      |
| rightButtonLabel | LINE 右側ボタンラベル名 |      |

**出力**

| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし   |        |      |

入力引数をチェックする。

| 論理名                  | 必須 | 長さ         | その他                              |
| ----------------------- | ---- | ------------ | ----------------------------------- |
| LINE 送信テキスト       | 必須 | 240 文字以下 |                                     |
| LINE 左側ボタンラベル名 | 必須 | 20 文字以下  | LINE 右側ボタンラベル名と異なること |
| LINE 右側ボタンラベル名 | 必須 | 20 文字以下  |                                     |

ブロードキャストメッセージを送信する。

```
{
	type: 'template',
	altText: <LINE 送信テキスト>,
	template: {
		type: 'confirm',
		text: <LINE 送信テキスト>,
		actions: [
		{
			type: 'postback',
			label: <LINE 左側ボタンラベル名>,
			data: '{eventID:<イベントID>, answer:"left"}',
			displayText: '送信しました',
		},
		{
			type: 'postback',
			label: <LINE 右側ボタンラベル名>,
			data: '{eventID:<イベントID>, answer:"right"}',
			displayText: '送信しました',
		},
		],
	},
}
```

# 参加登録 API

LINE プラットフォームから POST リクエストで呼び出される。

**入力**

| 物理名 | 論理名                       | 備考 |
| ------ | ---------------------------- | ---- | --- |
| -      | Webhook イベントオブジェクト |      |     |

**出力**

HTTP ステータスコード 200 を返す。
| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし | | |

`destination`から登録対象の管理者 LINE アカウントを特定する。

`source`の`userId`から友だちを取得する。

`postback`の`data`からイベント ID を取得する。

DB に以下の内容を保存する。

| 物理名 | 論理名 | 備考                       |
| ------ | ------ | -------------------------- |
| answer | 回答   | `postback`の`data`から取得 |

# 友だち登録/解除/更新 API

## 友だち登録 API

LINE プラットフォームから POST リクエストで呼び出される。

**入力**

| 物理名 | 論理名                       | 備考 |
| ------ | ---------------------------- | ---- | --- |
| -      | Webhook イベントオブジェクト |      |     |

**出力**

HTTP ステータスコード 200 を返す。
| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし | | |

`destination`から登録対象の管理者 LINE アカウントを特定する。

`source`の`userId`から友だちの LINE ID を取得する。

LINE のプロフィール情報取得 API を呼び出して、LINE ユーザーの表示名を取得する。

ユーザー ID を採番する。

DB に以下の内容を保存する。

| 物理名   | 論理名     | 備考        |
| -------- | ---------- | ----------- |
| lineID   | LINE ID    |             |
| userName | ユーザー名 | LINE 表示名 |
| status   | ステータス | `active`    |

## 友だち解除 API

LINE プラットフォームから POST リクエストで呼び出される。

**入力**

| 物理名 | 論理名                       | 備考 |
| ------ | ---------------------------- | ---- | --- |
| -      | Webhook イベントオブジェクト |      |     |

**出力**

HTTP ステータスコード 200 を返す。
| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし | | |

`destination`から登録対象の管理者 LINE アカウントを特定する。

`source`の`userId`から友だちの LINE ID を取得する。

DB に以下の内容を保存する。

| 物理名 | 論理名     | 備考       |
| ------ | ---------- | ---------- |
| status | ステータス | `inactive` |

## 友だち更新 API

**入力**

| 物理名   | 論理名      | 備考 |
| -------- | ----------- | ---- |
| userID   | ユーザー ID |      |
| userName | ユーザー名  |      |
| memo     | メモ        |      |

**出力**

| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし   |        |      |

入力引数をチェックする。

| 論理名      | 必須 | 長さ         |
| ----------- | ---- | ------------ |
| ユーザー ID | 必須 |              |
| ユーザー名  | 必須 | 100 文字以下 |
| メモ        | 任意 | 500 文字以下 |

DB に以下の内容を保存する。

| 物理名   | 論理名     | 備考 |
| -------- | ---------- | ---- |
| userName | ユーザー名 |      |
| memo     | メモ       |      |

# チャネル ID・シークレット登録/取得 API

## チャネル ID・シークレット登録

**入力**

| 物理名        | 論理名               | 備考 |
| ------------- | -------------------- | ---- |
| channelID     | チャネル ID          |      |
| channelSecret | チャネルシークレット |      |

**出力**

| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし   |        |      |

アクセストークン発行 API を呼び出す。発行に成功すれば正常、失敗したら異常。

## チャネル ID・シークレット取得

**入力**

| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし   |        |      |

**出力**

| 物理名        | 論理名               | 備考 |
| ------------- | -------------------- | ---- |
| channelID     | チャネル ID          |      |
| channelSecret | チャネルシークレット |      |

ユーザーが登録済みのチャネル ID・シークレットを返却する。

# アクセストークン発行/取得 API

## アクセストークン発行 API

**入力**

| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし   |        |      |

**出力**

| 物理名      | 論理名           | 備考 |
| ----------- | ---------------- | ---- |
| accessToken | アクセストークン |      |

チャネル ID・シークレットを取得する。
LINE API で短期のチャネルアクセストークンを発行する。
アクセストークンを DB に保存する。

## アクセストークン取得 API

**入力**

| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし   |        |      |

**出力**

| 物理名      | 論理名           | 備考 |
| ----------- | ---------------- | ---- |
| accessToken | アクセストークン |      |

DB からアクセストークンを取得する。

# イベント一覧取得 API

**入力**

| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし   |        |      |

**出力**

| 物理名    | 論理名         | 備考 |
| --------- | -------------- | ---- |
| eventID   | イベント ID    |      |
| eventName | イベント名     |      |
| createdAt | イベント作成日 |      |

# 個別イベント取得 API

**入力**

| 物理名  | 論理名      | 備考 |
| ------- | ----------- | ---- |
| eventID | イベント ID |      |

**出力**

| 物理名           | 論理名                  | 備考 |
| ---------------- | ----------------------- | ---- |
| message          | LINE 送信テキスト       |      |
| leftButtonLabel  | LINE 左側ボタンラベル名 |      |
| rightButtonLabel | LINE 右側ボタンラベル名 |      |
| answers          | 参加可否一覧            |      |

# イベント作成 API

**入力**

| 物理名           | 論理名                  | 備考 |
| ---------------- | ----------------------- | ---- |
| message          | LINE 送信テキスト       |      |
| leftButtonLabel  | LINE 左側ボタンラベル名 |      |
| rightButtonLabel | LINE 右側ボタンラベル名 |      |
| eventName        | イベント名              |      |

**出力**

| 物理名 | 論理名 | 備考 |
| ------ | ------ | ---- |
| なし   |        |      |

入力引数をチェックする。

| 論理名                  | 必須 | 長さ         | その他                              |
| ----------------------- | ---- | ------------ | ----------------------------------- |
| LINE 送信テキスト       | 必須 | 240 文字以下 |                                     |
| LINE 左側ボタンラベル名 | 必須 | 20 文字以下  | LINE 右側ボタンラベル名と異なること |
| LINE 右側ボタンラベル名 | 必須 | 20 文字以下  |                                     |
| イベント名              | 必須 | 100 文字以下 |                                     |

イベント ID を採番する。

ブロードキャストメッセージ送信 API を呼び出す。

DB に以下の内容を保存する。

| 物理名           | 論理名                  | 備考 |
| ---------------- | ----------------------- | ---- |
| eventID          | イベント ID             |      |
| eventName        | イベント名              |      |
| message          | LINE 送信テキスト       |      |
| leftButtonLabel  | LINE 左側ボタンラベル名 |      |
| rightButtonLabel | LINE 右側ボタンラベル名 |      |
